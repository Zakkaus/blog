---
slug: cloudflare-stats-worker-deploy
title: "Cloudflare Stats Worker - éšç§ä¼˜å…ˆçš„ç»Ÿè®¡ä»ªè¡¨æ¿"
date: 2025-01-08
tags: ["Cloudflare", "Analytics", "Workers", "Privacy"]
categories: ["Infrastructure"]
description: "éƒ¨ç½²ä½ è‡ªå·±çš„éšç§ä¼˜å…ˆç»Ÿè®¡ä»ªè¡¨æ¿,å°±åƒ stats.zakk.au ä¸€æ ·ä½¿ç”¨ Cloudflare Workers"
translationKey: "cloudflare-stats-deploy"
authors:
  - "Zakk"
---

æƒ³è¦å®æ—¶ç½‘ç«™ç»Ÿè®¡å´ä¸æƒ³ç”¨ Google Analytics?**Cloudflare Stats Worker** æ˜¯ä¸€ä¸ªå®Œå…¨è¿è¡Œåœ¨ Cloudflare è¾¹ç¼˜ç½‘ç»œä¸Šçš„éšç§ä¼˜å…ˆåˆ†ææ–¹æ¡ˆã€‚

çœ‹çœ‹å®é™…æ¡ˆä¾‹ï¼š**[stats.zakk.au](https://stats.zakk.au/)**

![ç»Ÿè®¡ä»ªè¡¨æ¿](stats-dashboard.webp)

## ä¸ºä»€ä¹ˆé€‰æ‹© Cloudflare Stats Worker?

- **éšç§ä¼˜å…ˆ**ï¼šæ—  Cookieï¼ŒIP åœ°å€ç» SHA-256 å“ˆå¸Œå¹¶æˆªæ–­
- **é›¶æˆæœ¬**ï¼šå¤§å¤šæ•°ä¸ªäººç½‘ç«™ä½¿ç”¨ Cloudflare å…è´¹æ–¹æ¡ˆå³å¯è¿è¡Œ
- **è¾¹ç¼˜æ€§èƒ½**ï¼šåŸºäº Cloudflare Workers + KVï¼Œå…¨çƒä½å»¶è¿Ÿè®¿é—®
- **å¤šè¯­è¨€æ”¯æŒ**ï¼šè‡ªåŠ¨è§„èŒƒåŒ–ä¸åŒè¯­è¨€ç‰ˆæœ¬çš„è·¯å¾„
- **å®Œæ•´æ–¹æ¡ˆ**ï¼šå•ä¸€ Worker åŒæ—¶æä¾› API ç«¯ç‚¹ä¸ç‹¬ç«‹ä»ªè¡¨æ¿

## ä¸»è¦ç‰¹è‰²

### å®æ—¶åˆ†æ
- ä»Šæ—¥ PV/UV å®æ—¶è®¡æ•°å™¨
- 7/14/30 å¤©å†å²è¶‹åŠ¿
- çƒ­é—¨é¡µé¢ Top 10 æ’è¡Œ

### ç²¾ç¾ä»ªè¡¨æ¿
- ç»ç’ƒæ‹Ÿæ€è®¾è®¡ï¼Œæ”¯æŒæ·±æµ…è‰²ä¸»é¢˜
- å“åº”å¼å¸ƒå±€ï¼Œæ”¯æŒæ‰‹æœºä¸æ¡Œé¢
- å¤šè¯­è¨€ç•Œé¢ï¼ˆç®€ä¸­/è‹±æ–‡ï¼‰
- å¯é€šè¿‡è‡ªå®šä¹‰åŸŸåè®¿é—®ï¼ˆå¦‚ stats.example.comï¼‰

### å¼€å‘è€…å‹å–„ API
- RESTful API ç«¯ç‚¹ï¼Œæ–¹ä¾¿è‡ªå®šä¹‰é›†æˆ
- æ‰¹æ¬¡æ“ä½œï¼Œé«˜æ•ˆæ•°æ®æŸ¥è¯¢
- å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼Œä¾¿äºç›‘æ§

## å¿«é€Ÿéƒ¨ç½²

> éœ€æ±‚ï¼šNode.js â‰¥ 18ã€`wrangler` CLI â‰¥ 3.0

1. **å…‹éš†å¹¶è¿›å…¥é¡¹ç›®ç›®å½•**
   ```bash
   git clone https://github.com/Zakkaus/cloudflare-stats-worker.git
   cd cloudflare-stats-worker
   ```

2. **å®‰è£… Wrangler å¹¶ç™»å½•**
   ```bash
   npm install -g wrangler
   wrangler login
   ```

3. **åˆ›å»º KV å‘½åç©ºé—´**
   ```bash
   wrangler kv namespace create PAGE_STATS
   wrangler kv namespace create PAGE_STATS --preview
   ```
   ç„¶åå°† ID ç²˜è´´åˆ° `wrangler.toml` ä¸­ã€‚

4. **ï¼ˆå¯é€‰ï¼‰å¯ç”¨ D1 ä»¥æ”¯æŒè¶‹åŠ¿å›¾ä¸çƒ­é—¨é¡µé¢**
   ```bash
   wrangler d1 create cloudflare-stats-top
   wrangler d1 execute cloudflare-stats-top --file=schema.sql --remote
   ```
   å–æ¶ˆ `wrangler.toml` ä¸­ `d1_databases` åŒºå—çš„æ³¨é‡Šï¼Œå¹¶å¡«å…¥ç”Ÿæˆçš„ IDã€‚

5. **éƒ¨ç½² ğŸ‰**
   ```bash
   wrangler deploy
   ```

## æ­¥éª¤ 7ï¼šè®¿é—®ç»Ÿè®¡ä»ªè¡¨æ¿

éƒ¨ç½²å®Œæˆåï¼Œç›´æ¥è®¿é—®ä½ çš„ä»ªè¡¨æ¿åŸŸåï¼š

```
https://stats.example.com/
```

ä½ ä¼šçœ‹åˆ°ä¸ [stats.zakk.au](https://stats.zakk.au/) ç›¸åŒçš„ç²¾ç¾åˆ†æç•Œé¢ï¼š

- **å®æ—¶æŒ‡æ ‡**ï¼šä»Šæ—¥ PV/UV å¡ç‰‡å®æ—¶æ›´æ–°
- **API å¥åº·çŠ¶æ€**ï¼šå¯è§†åŒ–ç³»ç»ŸçŠ¶æ€æŒ‡ç¤ºå™¨
- **è¶‹åŠ¿å›¾è¡¨**ï¼š7/14/30 å¤©äº¤äº’å¼å›¾è¡¨
- **çƒ­é—¨é¡µé¢**ï¼šæœ€å—æ¬¢è¿å†…å®¹æ’è¡Œæ¦œ
- **ä¸»é¢˜åˆ‡æ¢**ï¼šæ·±æµ…è‰²æ¨¡å¼è‡ªç”±åˆ‡æ¢
- **è¯­è¨€é€‰æ‹©å™¨**ï¼šç®€ä¸­/è‹±æ–‡ç•Œé¢é€‰é¡¹

ä»ªè¡¨æ¿å®Œå…¨ç‹¬ç«‹è¿ä½œ - æ— éœ€åµŒå…¥ï¼Œç›´æ¥åˆ†äº«ç½‘å€å³å¯ï¼

## å…è´¹æ–¹æ¡ˆä¸å‡çº§é€‰é¡¹

| æœåŠ¡ | å…è´¹é¢åº¦ | ä½•æ—¶å‡çº§ |
|------|---------|---------|
| **Workers** | æ¯æ—¥ 100k è¯·æ±‚<br>10ms CPU æ—¶é—´ | å½“æ¯æ—¥æµé‡è¶…è¿‡ 100k æˆ–éœ€è¦æ›´å¤§ CPU èµ„æºæ—¶ï¼Œå‡çº§åˆ° **Workers Paid ($5/æœˆ)**ã€‚ |
| **KV** | 1 GB å­˜å‚¨ç©ºé—´<br>æ¯æ—¥ 100k æ¬¡è¯»å–<br>æ¯æ—¥ 1k æ¬¡å†™å…¥ | å½“éœ€è¦å­˜å‚¨å¤§å‹ JSON æˆ–ä¿ç•™é•¿æœŸå†å²è®°å½•æ—¶ï¼Œå‡çº§åˆ°ä»˜è´¹æ–¹æ¡ˆã€‚ |
| **D1** | æ¯æœˆ 5M æ¬¡æŸ¥è¯¢<br>1 GB å­˜å‚¨ç©ºé—´ | å½“éœ€è¦å¤§é‡ä½¿ç”¨ Top 10 æ’è¡Œæˆ–é•¿æ—¶é—´è¶‹åŠ¿æŸ¥è¯¢æ—¶ï¼Œå‡çº§åˆ° D1 Paidã€‚ |

> **æ³¨æ„**ï¼šD1 æ˜¯å¯é€‰çš„ã€‚å¦‚æœä½ åªéœ€è¦å®æ—¶ PV/UV ç»Ÿè®¡ï¼ŒKV å·²è¶³å¤Ÿï¼Œä»ªè¡¨æ¿ä¾ç„¶å¯ç”¨ï¼ˆä»…ç¼ºå°‘ Top 10 ä¸è¶‹åŠ¿å›¾ï¼‰ã€‚

å¯¹å¤§å¤šæ•°ä¸ªäººç½‘ç«™æ¥è¯´ï¼Œå…è´¹æ–¹æ¡ˆç»°ç»°æœ‰ä½™ï¼

## API ç«¯ç‚¹

éƒ¨ç½²åï¼Œä½ å¯ä»¥è®¿é—®è¿™äº›ç«¯ç‚¹ï¼š

```bash
# å¥åº·æ£€æŸ¥
curl https://stats.example.com/health

# é¡µé¢æµè§ˆè®¡æ•°
curl "https://stats.example.com/api/count?url=/posts/example/"

# æ•´ä½“ç»Ÿè®¡
curl https://stats.example.com/api/stats

# æ¯æ—¥è¶‹åŠ¿
curl https://stats.example.com/api/daily
```

## æ¶æ„

```
æµè§ˆå™¨ â†’ Worker (stats.example.com)
          â”œâ”€â”€ /api/*     â†’ ç»Ÿè®¡ API
          â”œâ”€â”€ /*         â†’ ä»ªè¡¨æ¿é™æ€æ–‡ä»¶
          â””â”€â”€ Storage    â†’ Cloudflare KV
```

## å¸¸è§é—®é¢˜

### ä¸ºä»€ä¹ˆä¸ç”¨ Google Analytics?
è‡ªæ¶æ–¹æ¡ˆè®©ä½ å®Œå…¨æŒæ§æ•°æ®ï¼Œæ— éœ€ Cookieï¼Œä¸”ä¸ä¼šè¢«å¹¿å‘Šæ‹¦æˆªå™¨å°é”ã€‚

### å¯ä»¥è‡ªå®šä¹‰ä»ªè¡¨æ¿å—?
å½“ç„¶ï¼ä»ªè¡¨æ¿æºç åœ¨ dashboard/ æ–‡ä»¶å¤¹ï¼Œå¯ä¿®æ”¹ HTML/CSS/JS é…åˆä½ çš„å“ç‰Œé£æ ¼ã€‚

### å¦‚ä½•å¤‡ä»½æ•°æ®?
ä½¿ç”¨é¡¹ç›®æä¾›çš„å¤‡ä»½è„šæœ¬ï¼Œå®šæœŸå°† KV æ•°æ®å¯¼å‡ºåˆ° R2 æˆ– GitHubã€‚

---

è¿™å°±æ˜¯ [stats.zakk.au](https://stats.zakk.au/) èƒŒåçš„æŠ€æœ¯æ¶æ„ã€‚éƒ¨ç½²å®Œæˆåï¼Œä½ å°†æ‹¥æœ‰ï¼š

âœ… è‡ªå®šä¹‰åŸŸåçš„ç‹¬ç«‹ç»Ÿè®¡ä»ªè¡¨æ¿  
âœ… å®Œæ•´çš„ç»Ÿè®¡ REST API  
âœ… æ—  Cookie çš„éšç§ä¼˜å…ˆè¿½è¸ª  

å¦‚æœ‰é—®é¢˜ï¼Œæ¬¢è¿é€ è®¿ [GitHub Issues](https://github.com/Zakkaus/cloudflare-stats-worker/issues)ã€‚
