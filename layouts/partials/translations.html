{{ if .IsTranslated }}
  {{ $site := .Site }}
  {{ $scratch := newScratch }}
  {{ range $site.Languages }}
    {{ $scratch.Set (printf "label-%s" .Lang) (.Params.displayName | default .LanguageName | default (upper .Lang)) }}
  {{ end }}
  <div>
    <div class="cursor-pointer flex items-center nested-menu">
      <span class="me-1">
        {{ partial "icon.html" "language" }}
      </span>
      <div
        class="text-sm font-medium hover:text-primary-600 dark:hover:text-primary-400"
        title="{{ .Title }}">
        {{- i18n "global.language" | markdownify -}}
      </div>
    </div>
    <div class="absolute menuhide">
      <div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl">
        <div class="flex flex-col space-y-3">
          {{ range .AllTranslations }}
            {{ $lang := .Lang }}
            {{ $siteLang := .Site.Language.Lang }}
            {{ $rel := .RelPermalink }}
            {{ $scratch.Set "candidate" "" }}
            {{ $trimmed := trim $rel "/" }}
            {{ if $trimmed }}
              {{ $parts := split $trimmed "/" }}
              {{ $first := index $parts 0 }}
              {{ if $scratch.Get (printf "label-%s" $first) }}
                {{ $scratch.Set "candidate" $first }}
              {{ end }}
            {{ end }}
            {{ $langCode := or ($scratch.Get "candidate") $lang $siteLang }}
            {{ $label := or ($scratch.Get (printf "label-%s" $langCode)) (.Site.Language.Params.displayName | default .Site.Language.LanguageName | default (upper $langCode)) }}
            {{ $scratch.Delete "candidate" }}
            <a href="{{ .RelPermalink }}" class="flex items-center">
              <p
                class="text-sm font-sm hover:text-primary-600 dark:hover:text-primary-400"
                title="{{ .Title }}">
                {{ $label | emojify }}
              </p>
            </a>
          {{ end }}
        </div>
      </div>
    </div>
  </div>
{{ end }}
